name: Deploy to Nexus

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '23.11.0'

      - name: Configure npm for Nexus
        run: |
          echo "@bemily:registry=https://nexus.danalentertainment.com/repository/npm-bemily/" > .npmrc
          echo "//nexus.danalentertainment.com/repository/npm-bemily/:_auth=${{ secrets.NEXUS_AUTH_TOKEN }}" >> .npmrc

      - name: Install dependencies
        run: npm ci

      - name: Build package
        run: npm run build

      - name: Publish to Nexus
        run: npm publish
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NEXUS_AUTH_TOKEN }}

      - name: Deployment Summary
        if: success()
        run: |
          echo "## ðŸ“¦ Nexus ë°°í¬ ì™„ë£Œ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ë°°í¬ ì •ë³´" >> $GITHUB_STEP_SUMMARY
          echo "| í•­ëª© | ë‚´ìš© |" >> $GITHUB_STEP_SUMMARY
          echo "|------|------|" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸ“¦ íŒ¨í‚¤ì§€ | @bemily/design-system |" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸ”¢ ë²„ì „ | $(node -p "require('./package.json').version") |" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸŒ ë ˆì§€ìŠ¤íŠ¸ë¦¬ | Nexus npm-bemily |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### âœ… ë°°í¬ ì„±ê³µ" >> $GITHUB_STEP_SUMMARY
          echo "íŒ¨í‚¤ì§€ê°€ Nexusì— ì„±ê³µì ìœ¼ë¡œ ë°°í¬ë˜ì—ˆìŠµë‹ˆë‹¤." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ”— [Nexus Repository í™•ì¸í•˜ê¸°](https://nexus.danalentertainment.com/#browse/browse:npm-bemily)" >> $GITHUB_STEP_SUMMARY
