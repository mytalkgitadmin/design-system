name: Chromatic Deployment

on:
  # develop ë¸Œëžœì¹˜ì— push ì‹œ (merge í›„) Chromatic ë°°í¬
  push:
    branches: [develop]

jobs:
  chromatic:
    runs-on: ubuntu-latest

    steps:
      - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Chromaticì—ì„œ ë³€ê²½ì‚¬í•­ ë¹„êµë¥¼ ìœ„í•´ ì „ì²´ ížˆìŠ¤í† ë¦¬ í•„ìš”

      - name: Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"

      - name: ì˜ì¡´ì„± ì„¤ì¹˜
        run: npm ci

      - name: Storybook ë¹Œë“œ ê²€ì¦
        run: npm run build-storybook

      - name: Chromatic ë°°í¬
        id: chromatic
        uses: chromaui/action@latest
        with:
          projectToken: ${{ secrets.CHROMATIC_PROJECT_TOKEN }}
          # develop ë¸Œëžœì¹˜ ë°°í¬ ì‹œ ìžë™ìœ¼ë¡œ baseline ìŠ¹ì¸
          autoAcceptChanges: true

      - name: ë°°í¬ ê²°ê³¼ Summary ìƒì„±
        if: always()
        run: |
          echo "## ðŸŽ¨ Chromatic ë°°í¬ ê²°ê³¼" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“Š ë°°í¬ ì •ë³´" >> $GITHUB_STEP_SUMMARY
          echo "| í•­ëª© | ë‚´ìš© |" >> $GITHUB_STEP_SUMMARY
          echo "|------|------|" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸŒ Storybook | [ë°°í¬ëœ Storybook ë³´ê¸°](${{ steps.chromatic.outputs.storybookUrl }}) |" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸ” Chromatic Build | [ë¹Œë“œ ìƒì„¸ë³´ê¸°](${{ steps.chromatic.outputs.buildUrl }}) |" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸ“š í…ŒìŠ¤íŠ¸ëœ ìŠ¤í† ë¦¬ | ${{ steps.chromatic.outputs.specCount }}ê°œ |" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸŽ¯ ë³€ê²½ì‚¬í•­ | ${{ steps.chromatic.outputs.changeCount }}ê°œ |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### âœ… develop ë¸Œëžœì¹˜ ë°°í¬ ì™„ë£Œ" >> $GITHUB_STEP_SUMMARY
          echo "Storybookì´ Chromaticì— ì„±ê³µì ìœ¼ë¡œ ë°°í¬ë˜ì—ˆìŠµë‹ˆë‹¤." >> $GITHUB_STEP_SUMMARY
